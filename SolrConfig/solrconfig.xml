<?xml version="1.0" encoding="UTF-8" ?>
<config>
  <luceneMatchVersion>6.0.1</luceneMatchVersion>

  <lib dir="${solr.install.dir:../../../..}/contrib/extraction/lib" regex=".*\.jar" />
  <lib dir="${solr.install.dir:../../../..}/dist/" regex="solr-cell-\d.*\.jar" />

  <lib dir="${solr.install.dir:../../../..}/contrib/clustering/lib/" regex=".*\.jar" />
  <lib dir="${solr.install.dir:../../../..}/dist/" regex="solr-clustering-\d.*\.jar" />

  <lib dir="${solr.install.dir:../../../..}/contrib/langid/lib/" regex=".*\.jar" />
  <lib dir="${solr.install.dir:../../../..}/dist/" regex="solr-langid-\d.*\.jar" />

  <lib dir="${solr.install.dir:../../../..}/contrib/velocity/lib" regex=".*\.jar" />
  <lib dir="${solr.install.dir:../../../..}/dist/" regex="solr-velocity-\d.*\.jar" />

  <dataDir>${solr.data.dir:}</dataDir>

  <directoryFactory name="DirectoryFactory" 
                    class="${solr.directoryFactory:solr.NRTCachingDirectoryFactory}"/>
 
  <schemaFactory class="ClassicIndexSchemaFactory"/>
  <codecFactory class="solr.SchemaCodecFactory"/>

  <indexConfig>
    <useCompoundFile>false</useCompoundFile>
    <mergeFactor>3</mergeFactor>
    <ramBufferSizeMB>256</ramBufferSizeMB>
    <writeLockTimeout>1000</writeLockTimeout>
    <lockType>${solr.lock.type:native}</lockType>
  </indexConfig>

  <jmx />

  <updateHandler class="solr.DirectUpdateHandler2">
    <updateLog>
      <str name="dir">${solr.ulog.dir:}</str>
    </updateLog>
 
     <autoCommit> 
       <maxDocs>5000</maxDocs>
       <maxTime>30000</maxTime> 
       <openSearcher>false</openSearcher> 
     </autoCommit>

     <autoSoftCommit> 
       <maxTime>60000</maxTime> 
     </autoSoftCommit>
  </updateHandler>
  
  <query>
    <filterCache class="solr.FastLRUCache"
                 size="4096"
                 initialSize="512"
                 autowarmCount="1024"/>
    <fieldValueCache class="solr.FastLRUCache" 
		 size="100" 
		 autowarmCount="0" 
		 showItems="100" />
    <queryResultCache class="solr.LRUCache"
                     size="512"
                     initialSize="512"
                     autowarmCount="0"/>
    <documentCache class="solr.FastLRUCache"
                   size="8192"
                   initialSize="1024"
                   autowarmCount="2048"/>
    <enableLazyFieldLoading>true</enableLazyFieldLoading>
    <queryResultWindowSize>60</queryResultWindowSize>
    <queryResultMaxDocsCached>200</queryResultMaxDocsCached>
    <maxWarmingSearchers>1</maxWarmingSearchers>
  </query>

  <admin>
    <defaultQuery>solr</defaultQuery>
  </admin>
  
  <requestDispatcher handleSelect="false" >
    <requestParsers enableRemoteStreaming="true" 
                    multipartUploadLimitInKB="2048000"
                    formdataUploadLimitInKB="2048" />
  </requestDispatcher>

  <requestHandler name="/select" class="solr.SearchHandler" default="true">
	<lst name="defaults">
		<str name="defType">edismax</str>
		<str name="q.alt">*:*</str>
		<str name="rows">10</str>
		<str name="qf">text</str>
		<str name="pf"></str>
		<str name="mm">4&lt;90%</str>
		<str name="fl">unique_id</str>			
		<int name="timeAllowed">4000</int>
	</lst>
	<arr name="last-components">
		<str>spellcheck</str>
	</arr>
  </requestHandler>

  <requestHandler name="/analysis/field" 
                  startup="lazy"
                  class="solr.FieldAnalysisRequestHandler" />

  <requestHandler name="/update" class="solr.UpdateRequestHandler" />

  <requestHandler name="/admin/ping" class="solr.PingRequestHandler">
	<lst name="invariants">
		<str name="q">solrpingquery</str>
	</lst>
	<lst name="defaults">
		<str name="echoParams">all</str>
	</lst>
  </requestHandler>

  <requestHandler name="/replication" class="solr.ReplicationHandler">
	<lst name="master"> 
		<!--<str name="enable">${enable.master:false}</str> -->
		<str name="replicateAfter">commit</str> 
		<str name="replicateAfter">startup</str> 
		<str name="confFiles">solrconfig.xml,schema.xml</str>  
	</lst> 
	<!--<lst name="slave"> 
		<str name="enable">${enable.slave:false}</str> 
		<str name="masterUrl">http://${master.core.url}/${solr.core.name}/replication</str> 
		<str name="pollInterval">${poll.time}</str> 
	</lst>-->
  </requestHandler>

  <requestHandler name="/get" class="solr.RealTimeGetHandler">
	<lst name="defaults">
		<str name="omitHeader">true</str>
		<str name="wt">json</str>
		<str name="indent">true</str>
	</lst>
  </requestHandler>

  <requestHandler name="/analysis/document" 
                  class="solr.DocumentAnalysisRequestHandler" 
                  startup="lazy" />

  <searchComponent name="spellcheck" class="solr.SpellCheckComponent">
   <str name="queryAnalyzerFieldType">spellFieldType</str>
    <!-- a spellchecker built from a field of the main index -->
   <lst name="spellchecker">
      <str name="name">default</str>
      <str name="field">spellField</str>
      <str name="classname">solr.DirectSolrSpellChecker</str>
      <!-- the spellcheck distance measure used, the default is the internal levenshtein -->
      <str name="distanceMeasure">internal</str>
      <!-- minimum accuracy needed to be considered a valid spellcheck suggestion -->
      <float name="accuracy">0.7</float>
      <!-- the maximum #edits we consider when enumerating terms: can be 1 or 2 -->
      <int name="maxEdits">2</int>
      <!-- the minimum shared prefix when enumerating terms -->
      <int name="minPrefix">0</int>
      <!-- maximum number of inspections per result. -->
      <int name="maxInspections">5</int>
      <!-- minimum length of a query term to be considered for correction -->
      <int name="minQueryLength">2</int>
      <!-- maximum threshold of documents a query term can appear to be considered for correction -->
      <float name="maxQueryFrequency">0.01</float>
      <!-- uncomment this to require suggestions to occur in 1% of the documents -->
      <float name="thresholdTokenFrequency">0.00001</float>
    </lst>
    
    <!-- a spellchecker that can break or combine words.  See "/spell" handler below for usage -->
    <lst name="spellchecker">
      <str name="name">wordbreak</str>
      <str name="classname">solr.WordBreakSolrSpellChecker</str>      
      <str name="field">spellField</str>
      <str name="combineWords">true</str>
      <str name="breakWords">true</str>
      <int name="maxChanges">2</int>
      <str name="comparatorClass">freq</str>
    </lst>
    <lst name="spellchecker">
      <str name="classname">org.apache.solr.spelling.FileBasedSpellChecker</str>
    </lst>
  </searchComponent>
  
  <requestHandler name="/spell" class="solr.SearchHandler" startup="lazy">
    <lst name="defaults">
      <str name="spellcheck.dictionary">default</str>
      <str name="spellcheck.dictionary">wordbreak</str>
      <str name="spellcheck">on</str>
      <str name="spellcheck.extendedResults">true</str>       
      <str name="spellcheck.count">10</str>
      <str name="spellcheck.alternativeTermCount">5</str>
      <str name="spellcheck.maxResultsForSuggest">5</str>       
      <str name="spellcheck.collate">true</str>
      <str name="spellcheck.collateExtendedResults">true</str>  
      <str name="spellcheck.maxCollationTries">10</str>
      <str name="spellcheck.maxCollations">5</str>         
    </lst>
    <arr name="last-components">
      <str>spellcheck</str>
    </arr>
  </requestHandler>

  <searchComponent name="suggest" class="solr.SuggestComponent">
    <lst name="suggester">
      <str name="name">mySuggester</str>
      <str name="lookupImpl">FuzzyLookupFactory</str>      
      <str name="dictionaryImpl">DocumentDictionaryFactory</str>
      <str name="field">text</str>
      <str name="weightField">price</str>
      <str name="suggestAnalyzerFieldType">string</str>
      <str name="buildOnStartup">false</str>
    </lst>
  </searchComponent>

  <requestHandler name="/suggest" class="solr.SearchHandler" startup="lazy" >
    <lst name="defaults">
      <str name="suggest">true</str>
      <str name="suggest.count">10</str>
    </lst>
    <arr name="components">
      <str>suggest</str>
    </arr>
  </requestHandler>

</config>
